// Code generated by queryx, DO NOT EDIT.

package queryx

import (
	"database/sql"
	"regexp"
)

type DB interface {
	Exec(query string, args ...interface{}) (sql.Result, error)
	Query(query string, args ...interface{}) (*sql.Rows, error)
}

type Adapter struct {
	db DB
}

func NewAdapter(db DB) *Adapter {
	return &Adapter{db: db}
}

func (a *Adapter) Query(query string, args ...interface{}) *Rows {
	return &Rows{
		adapter: a,
		query:   query,
		args:    args,
	}
}

type Rows struct {
	adapter *Adapter
	query   string
	args    []interface{}
	err     error
}

func (r *Rows) Scan(v interface{}) error {
	if r.err != nil {
		return r.err
	}
	var err error
	query, args := r.query, r.args
	matched1, err := regexp.MatchString(`.* IN (.*?)`, query)
	if err != nil {
		return err
	}
	matched2, err := regexp.MatchString(`.* in (.*?)`, query)
	if err != nil {
		return err
	}
	if matched1 || matched2 {
		query, args, err = In(query, args...)
		if err != nil {
			return err
		}
	}
	query, args = rebind(query, args)
	rows, err := r.adapter.db.Query(query, args...)
	if err != nil {
		return err
	}
	err = ScanSlice(rows, v)
	if err != nil {
		return err
	}
	return err
}

type Row struct {
	adapter *Adapter
	query   string
	args    []interface{}
}

func (r *Row) Scan(v interface{}) error {
	query, args := r.query, r.args
	matched1, err := regexp.MatchString(`.* IN (.*?)`, query)
	if err != nil {
		return err
	}
	matched2, err := regexp.MatchString(`.* in (.*?)`, query)
	if err != nil {
		return err
	}
	if matched1 || matched2 {
		query, args, err = In(query, args...)
		if err != nil {
			return err
		}
	}
	query, args = rebind(query, args)
	rows, err := r.adapter.db.Query(query, args...)
	if err != nil {
		return err
	}
	err = ScanOne(rows, v)
	if err != nil {
		return err
	}
	return err
}

func (a *Adapter) QueryOne(query string, args ...interface{}) *Row {
	return &Row{
		adapter: a,
		query:   query,
		args:    args,
	}
}
